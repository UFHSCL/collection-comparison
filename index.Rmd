---
title: "HSCL Peer Institution Collection Comparison"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    theme: flatly
    social: menu
    source_code: https://github.com/ufhscl/collection-comparison/dashboard.Rmd
---

```{r setup, include = FALSE}
library(highcharter)
library(tidyverse)
library(DT)

collections_data <- readRDS("collections_data.Rdata")
```

```{r}
rank_data <- collections_data %>% 
  count(resource) %>%
  arrange(desc(n)) %>%
  mutate(rank = row_number()) %>%
  select(!n)

summary_count <- collections_data %>%
    count(resource, region) %>%
    complete(resource, region, fill = list(n = 0)) %>%
    left_join(rank_data) %>%
    arrange(rank)

resource_data <- collections_data %>%
  select(!one_of("school", "code", "region")) %>%
  distinct()
```



Resources (most owned by peers)
===================================== 

Column {data-width=800}
-----------------------------------------------------------------------

### Resources by Peer Institution

```{r}
hchart(summary_count, "bar", hcaes(x = resource, y = n, 
                                  group = region)) %>%
    hc_plotOptions(series = list(
        stacking = "normal")
    ) %>%
    hc_xAxis(title = list(
        text = "Resource")
    ) %>%
    hc_yAxis(title = list(
        text = "Number of Peer Institutions")
    )
```


Data 
===================================== 

Column {data-width=800}
-----------------------------------------------------------------------

```{r}
resource_info <- summary_count %>%
  pivot_wider(names_from = region, values_from = n) %>%
  left_join(resource_data) %>%
  mutate("Total peers with" = Florida + US, 
         "Florida peers with" = Florida, 
         "US peers with" = US) %>%
  select(!one_of("Florida", "US", "rank")) %>%
  select(resource, "Total peers with", "Florida peers with", "US peers with", everything())

datatable(resource_info, 
          options = list(pageLength = 53, 
                         scrollY = "800px"))
```


